<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="This is my blog"><title>为什么使用Kafka | DuBo's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">为什么使用Kafka</h1><a id="logo" href="/.">DuBo's Blog</a><p class="description">杜波的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">为什么使用Kafka</h1><div class="post-meta">Mar 20, 2018<span> | </span><span class="category"><a href="/categories/Kafka/">Kafka</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="最初的应用系统"><a href="#最初的应用系统" class="headerlink" title="最初的应用系统"></a>最初的应用系统</h2><p> <img src="http://od4y7wzt7.bkt.clouddn.com/15215506556858.jpg" alt=""></p>
<p><strong>直接在应用系统和消息服务器之间建立连接。</strong></p>
<h2 id="多个直联的消息应用系统"><a href="#多个直联的消息应用系统" class="headerlink" title="多个直联的消息应用系统"></a>多个直联的消息应用系统</h2><p><img src="http://od4y7wzt7.bkt.clouddn.com/15215506701680.jpg" alt=""></p>
<p><strong>为进行度量指标的分析增加分析服务器<br>以及活动监控数据库监控信息服务器</strong><br><strong>这时候节点变得一团糟</strong></p>
<h2 id="指标发布与订阅系统"><a href="#指标发布与订阅系统" class="headerlink" title="指标发布与订阅系统"></a>指标发布与订阅系统</h2><p><img src="http://od4y7wzt7.bkt.clouddn.com/15215507633282.jpg" alt=""></p>
<p><strong>为解决一部分技术债务，开始使用单独一个服务器用来接收来自其他应用程序的度量指标，并为其他系统提供一个查询服务器。</strong></p>
<h2 id="多个发布与订阅系统"><a href="#多个发布与订阅系统" class="headerlink" title="多个发布与订阅系统"></a>多个发布与订阅系统</h2><p><img src="http://od4y7wzt7.bkt.clouddn.com/15215508356354.jpg" alt=""></p>
<p>提供多个发布与订阅系统，但后期维护性差，需要维护多个发布与订阅系统。每个系统都有缺陷和不足。</p>
<h2 id="真正需要的是一个单一的集中式系统"><a href="#真正需要的是一个单一的集中式系统" class="headerlink" title="真正需要的是一个单一的集中式系统"></a>真正需要的是一个单一的集中式系统</h2><p><img src="http://od4y7wzt7.bkt.clouddn.com/15215509726946.jpg" alt=""></p>
<p><strong><em>Kafka就是为解决上述问题的基于发布和订阅的消息系统</em></strong></p>
<h2 id="消息和批次"><a href="#消息和批次" class="headerlink" title="消息和批次"></a>消息和批次</h2><ol>
<li><p>在Kafka中数据单元被称为 <strong>消息</strong> 。可以吧消息看作数据库里的一行“数据行”或者一条“记录” 消息会被按键的hash值，分配到不同的分区中。</p>
</li>
<li><p>为提高效率，消息分批次写入Kafka。 <strong>批次</strong> 就是一组消息，这些消息属于同一个主题和分区。</p>
</li>
</ol>
<h2 id="topic和partition（主题和分区）"><a href="#topic和partition（主题和分区）" class="headerlink" title="topic和partition（主题和分区）"></a>topic和partition（主题和分区）</h2><ol>
<li>Kafka的消息通过主题进行分类。主题好比数据库表。一个主题可以被分为若干分区。由于一个主题通常包含多个分区，因此无法在整个主题范围内保证消息的顺序，但可以保证消息在单个分区内的顺序。</li>
</ol>
<p><img src="http://od4y7wzt7.bkt.clouddn.com/15215515572983.jpg" alt=""></p>
<h2 id="生产者和消费者"><a href="#生产者和消费者" class="headerlink" title="生产者和消费者"></a>生产者和消费者</h2><ol>
<li>生产者创造消息。一般情况下，一个消息会被发布在一个特定的主题上，默认生产者会把消息均匀的分布到主题上的所有分区中。特殊情况下，生产者可以吧消息写入到指定分区中。通过指定消息的键和分区器。分区器是为消息的键生成一个HASH值，映射在不同分区。</li>
<li>消费者读取消息。消费者订阅一个或多个主题，并按照顺序读区它们。消费者是通过检查偏移量来区分已经读过的消息。消费者会在每个分区读取完后，将偏移量写入zookeeper中。保证下次读取不会造成重复或缺少。</li>
<li>消费者群组。消费者是消费者群组的一部分。会有多个消费者一起读取同一个主题。群组保证每个分区只能被一个消费者读取<br><img src="http://od4y7wzt7.bkt.clouddn.com/15215520825928.jpg" alt=""><br>此时两个消费者各自读取一个分区。一个消费者单独读取两个分区。<br>消费者和分区的映射关系被称作消费者对分区的所有权关系。</li>
</ol>
<p>通过该方式。消费者在失效后，群组里的其他消费者会代替它接管它之前消费的分区。</p>
<h2 id="broker和集群"><a href="#broker和集群" class="headerlink" title="broker和集群"></a>broker和集群</h2><p>一台单独的Kafka服务器被称为broker。broker接受来自生产者的消息。并设置偏移量，以及提交消息到磁盘中。消息会在broker中进行保存。broker为消费者提供服务。对读取分区作出相应，返回已经提交到磁盘上的信息。</p>
<p>broker组成集群。每个集群都有一台broker充当集群控制器。负责将分区分配到不同的broker中和监控broker。在集群中，一个分区从属于一个broker，该broker称为该分区的首领leader。一个分区可以通过复制，将副本分配到不同的broker中，这样就避免了单点问题。如果一个broker失效，其他broker就可以接管对分区的leader。</p>
<p><img src="http://od4y7wzt7.bkt.clouddn.com/15215525977860.jpg" alt=""></p>
<h2 id="为什么选择Kafka"><a href="#为什么选择Kafka" class="headerlink" title="为什么选择Kafka"></a>为什么选择Kafka</h2><ol>
<li>可以有无缝的支持多个生产者和消费者。并且消费者之间互不影响。多个消费者可以组成群组，共享一个消息流，保证整个群组对给定的消息只处理一次。</li>
<li>消费者可以非实时读取数据。这归功于Kafka的消息保留特性。消息会被提交到磁盘中，并按一定的规则进行保存。持久化数据，保证数据不会丢失。</li>
<li>伸缩性。Kafka从一开始就被设计为一个灵活的伸缩性系统。可以从单独的一个broker，逐步发展到多个broker的小型集群模式。随后逐步发展到上百个broker。并且及时个别broker失效，依旧能为用户提供消费服务。</li>
</ol>
<hr>
<p><strong>以上内容参考翻译于<br><a href="https://www.amazon.com/Kafka-Definitive-Real-Time-Stream-Processing/dp/1491936169/ref=sr_1_2?ie=UTF8&amp;qid=1521553212&amp;sr=8-2&amp;keywords=Kafka&amp;dpID=517s6ZK4-PL&amp;preST=_SX218_BO1,204,203,200_QL40_&amp;dpSrc=srch" target="_blank" rel="external">Kafka_The_Definitive_Guide</a></strong></p>
<hr>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://dbdb5269.github.io/2018/03/20/为什么使用Kafka/" data-id="cjiy6g95m002pp9jktn2t84oa" class="article-share-link">分享</a><div class="tags"><a href="/tags/Kafka/">Kafka</a></div><div class="post-nav"><a href="/2018/04/21/oracle行级锁/" class="pre">oracle行级锁</a><a href="/2018/02/22/搭建Kafka和zookeeper集群/" class="next">搭建Kafka和zookeeper集群</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://dbdb5269.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Apple/">Apple</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ElasticSearch/">ElasticSearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kafka/">Kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-X/">OS X</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/">Swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tika/">Tika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Xcode/">Xcode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/太原理工大学/">太原理工大学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网站资源/">网站资源</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/模拟登录/" style="font-size: 15px;">模拟登录</a> <a href="/tags/学习笔记/" style="font-size: 15px;">学习笔记</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/菜单栏/" style="font-size: 15px;">菜单栏</a> <a href="/tags/软件/" style="font-size: 15px;">软件</a> <a href="/tags/拓展/" style="font-size: 15px;">拓展</a> <a href="/tags/三指拖动/" style="font-size: 15px;">三指拖动</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/PD/" style="font-size: 15px;">PD</a> <a href="/tags/Wi-Fi/" style="font-size: 15px;">Wi-Fi</a> <a href="/tags/MD5/" style="font-size: 15px;">MD5</a> <a href="/tags/PyCharm/" style="font-size: 15px;">PyCharm</a> <a href="/tags/Email/" style="font-size: 15px;">Email</a> <a href="/tags/QQ/" style="font-size: 15px;">QQ</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/JDK/" style="font-size: 15px;">JDK</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/行级锁/" style="font-size: 15px;">行级锁</a> <a href="/tags/Linux命令/" style="font-size: 15px;">Linux命令</a> <a href="/tags/URP教务系统/" style="font-size: 15px;">URP教务系统</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/IP/" style="font-size: 15px;">IP</a> <a href="/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/slide/" style="font-size: 15px;">slide</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/terminal/" style="font-size: 15px;">terminal</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/Simulator/" style="font-size: 15px;">Simulator</a> <a href="/tags/农银/" style="font-size: 15px;">农银</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/培训/" style="font-size: 15px;">培训</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/大学/" style="font-size: 15px;">大学</a> <a href="/tags/Zookeeper/" style="font-size: 15px;">Zookeeper</a> <a href="/tags/知乎/" style="font-size: 15px;">知乎</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/图片/" style="font-size: 15px;">图片</a> <a href="/tags/链家/" style="font-size: 15px;">链家</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/21/oracle行级锁/">oracle行级锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/为什么使用Kafka/">为什么使用Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/搭建Kafka和zookeeper集群/">搭建Kafka和zookeeper集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/nextTheme/">nextTheme</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/30/shell教程指南/">shell教程指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/TCP-IP小故事/">TCP/IP小故事</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/27/Tika入门学习/">Tika入门学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/ElasticSearch学习笔记/">ElasticSearch学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/30/Linux基础命令学习/">Linux基础命令学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/修改MacBook的hostname/">修改MacBook的hostname</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.mrdubo.com/" title="资源网站" target="_blank">资源网站</a><ul></ul><a href="http://xiaotian.me/" title="天哥" target="_blank">天哥</a><ul></ul><a href="http://zhurunshi.com/" title="润石blog" target="_blank">润石blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">DuBo's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"> 晋ICP备15007212号.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>