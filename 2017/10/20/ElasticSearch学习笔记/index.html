<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="This is my blog"><title>ElasticSearch学习笔记 | DuBo's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ElasticSearch学习笔记</h1><a id="logo" href="/.">DuBo's Blog</a><p class="description">杜波的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ElasticSearch学习笔记</h1><div class="post-meta">Oct 20, 2017<span> | </span><span class="category"><a href="/categories/ElasticSearch/">ElasticSearch</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h1 id="ElasticSearch定义"><a href="#ElasticSearch定义" class="headerlink" title="ElasticSearch定义"></a>ElasticSearch定义</h1><ol>
<li>index索引含义<ol>
<li>一个索引index就像传统关系数据库的数据库，它是存储相关文档存储的地方</li>
<li>索引一个文档，表示把一个文档存储到索引中，以便他可以被检索或者查询</li>
</ol>
</li>
<li>shard分片<ol>
<li>我们的文档存储在分片中，并且在分片中被索引</li>
</ol>
</li>
</ol>
<h1 id="ElasticSearch安装和配置"><a href="#ElasticSearch安装和配置" class="headerlink" title="ElasticSearch安装和配置"></a>ElasticSearch安装和配置</h1><h4 id="ElasticSearch-安装"><a href="#ElasticSearch-安装" class="headerlink" title="ElasticSearch 安装"></a>ElasticSearch 安装</h4><p>ElasticSearch基于JDK1.8，请先安装JDK<br>关于Linux如何安装JDK和配置<br>请参考<a href="http://blog.mrdubo.com/2017/06/02/Ubuntu%E4%B8%8B%E9%85%8D%E7%BD%AEjdk/" target="_blank" rel="external">Ubuntu下配置jdk</a></p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.3.tar.gz</div><div class="line"></div><div class="line">tar -xvf elasticsearch-5.6.3.tar.gz</div><div class="line"></div><div class="line"><span class="built_in">cd</span> elasticsearch-5.6.3/bin</div><div class="line"></div><div class="line">./elasticsearch   <span class="comment">#启动</span></div></pre></td></tr></table></figure>
<h4 id="ElasticSearch配置"><a href="#ElasticSearch配置" class="headerlink" title="ElasticSearch配置"></a>ElasticSearch配置</h4><figure class="highlight ldif"><table><tr><td class="code"><pre><div class="line">由于虚拟机内存问题</div><div class="line">需要将JVM虚拟机内存设置修改</div><div class="line">./elasticsearch-5.6.3/config/jvm.options</div><div class="line">修改</div><div class="line"><span class="comment"># Xms represents the initial size of total heap space</span></div><div class="line"><span class="comment"># Xmx represents the maximum size of total heap space</span></div><div class="line"><span class="comment">#从2g修改为1g</span></div><div class="line"></div><div class="line"><span class="literal">-Xms1g</span></div><div class="line"><span class="literal">-Xmx1g</span></div></pre></td></tr></table></figure>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line">max file descriptors [4096] <span class="keyword">for</span> elasticsearch process likely too low, increase <span class="keyword">to</span> at least [65536]</div><div class="line">max number of threads [1024] <span class="keyword">for</span><span class="built_in"> user </span>[lishang] likely too low, increase <span class="keyword">to</span> at least [2048]</div><div class="line"></div><div class="line">切换到root用户，编辑limits.conf 添加类似如下内容</div><div class="line"></div><div class="line">vi /etc/security/limits.conf </div><div class="line"></div><div class="line">添加如下内容:</div><div class="line"></div><div class="line">* soft nofile 655360</div><div class="line"></div><div class="line">* hard nofile 131072</div><div class="line"></div><div class="line">* soft nproc 2048</div><div class="line"></div><div class="line">* hard nproc 4096</div><div class="line">--------------------------------------</div><div class="line">或者以一下方法</div><div class="line">sysctl -w vm.<span class="attribute">max_map_count</span>=655360</div><div class="line"></div><div class="line">并用以下命令查看是否修改成功</div><div class="line"></div><div class="line">sysctl -a | grep <span class="string">"vm.max_map_count"</span></div><div class="line">如果能正常输出655360，则说明修改成功，然后再次启动elasticsearch</div></pre></td></tr></table></figure>
<h4 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h4><p>远程访问主机<br>需要在config目录下的elasticsearch.yml修改如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">network.host: 0.0.0.0</div><div class="line">http.port: 9200</div><div class="line">transport.host: localhost</div><div class="line">transport.tcp.port: 9300</div></pre></td></tr></table></figure>
<h4 id="插件cerebro安装"><a href="#插件cerebro安装" class="headerlink" title="插件cerebro安装"></a>插件cerebro安装</h4><p>插件cerebro的GitHub地址为<a href="https://github.com/lmenezes/cerebro/" target="_blank" rel="external">GitHub https://github.com/lmenezes/cerebro/</a></p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><div class="line">wget https://github.com/lmenezes/cerebro/releases/download/v0<span class="meta">.6</span><span class="meta">.5</span>/cerebro-<span class="number">0.6</span><span class="meta">.5</span>.tgz</div><div class="line">tar zxvf cerebro-<span class="number">0.6</span><span class="meta">.5</span>.tgz</div><div class="line">cd cerebro-<span class="number">0.6</span><span class="meta">.5</span>/</div><div class="line">bin/cerebro</div><div class="line">#可以直接通过外网端口访问 http://yourip:<span class="number">9000</span>/</div></pre></td></tr></table></figure>
<h1 id="ElasticSearch搜索curl"><a href="#ElasticSearch搜索curl" class="headerlink" title="ElasticSearch搜索curl"></a>ElasticSearch搜索curl</h1><h4 id="新建索引"><a href="#新建索引" class="headerlink" title="新建索引"></a>新建索引</h4><p>新建并设置主分片和复制分片</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">PUT tj</div><div class="line">&#123;</div><div class="line">  <span class="string">"settings"</span>: &#123;</div><div class="line">    <span class="string">"number_of_shards"</span>: <span class="number">3</span>,</div><div class="line">    <span class="string">"number_of_replicas"</span>: <span class="number">1</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="修改mapping"><a href="#修改mapping" class="headerlink" title="修改mapping"></a>修改mapping</h4><figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">POST tj/mail/_mapping</div><div class="line">&#123;</div><div class="line">  <span class="string">"properties"</span>: &#123;</div><div class="line">    <span class="string">"name"</span>:&#123;</div><div class="line">      <span class="string">"type"</span>: <span class="string">"text"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"age"</span>:&#123;</div><div class="line">      <span class="string">"type"</span>: <span class="string">"integer"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line"><span class="builtin-name">GET</span> tj/mail</div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>:<span class="string">"dubo"</span>,</div><div class="line">  <span class="string">"age"</span>:23</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="轻量搜索"><a href="#轻量搜索" class="headerlink" title="轻量搜索"></a>轻量搜索</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line"><span class="builtin-name">GET</span> tj/mail/_search</div><div class="line"></div><div class="line"><span class="builtin-name">GET</span> tj/mail/_search?<span class="attribute">q</span>=name:dubo</div></pre></td></tr></table></figure>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><figure class="highlight sqf"><table><tr><td class="code"><pre><div class="line">全部更新会是直接把之前的老数据，标记为删除状态，然后，再添加一条更新的。</div><div class="line"></div><div class="line">是局部更新不会覆盖其他数据</div><div class="line"></div><div class="line">POST <span class="variable">_index</span>/<span class="variable">_type</span>/<span class="variable">_id</span>/<span class="variable">_update</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"doc"</span>:&#123;</div><div class="line">    </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="查询表达式搜索"><a href="#查询表达式搜索" class="headerlink" title="查询表达式搜索"></a>查询表达式搜索</h4><figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">GET /tj/mail/_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"match"</span> : &#123;</div><div class="line">            <span class="string">"name"</span> : <span class="string">"dubo"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="范围搜索"><a href="#范围搜索" class="headerlink" title="范围搜索"></a>范围搜索</h4><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line"><span class="meta">#过滤器搜索</span></div><div class="line">GET tj<span class="meta-keyword">/mail/</span><span class="class">_search</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"bool"</span>: &#123;</div><div class="line">      <span class="string">"filter"</span>: &#123;</div><div class="line">        <span class="string">"range"</span>: &#123;</div><div class="line">          <span class="string">"FIELD"</span>: &#123;</div><div class="line">            <span class="string">"gte"</span>: <span class="number">10</span>,<span class="meta">#大于等于 great than</span></div><div class="line">            <span class="string">"lte"</span>: <span class="number">20</span> <span class="meta">#小于等于 less than</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="复杂的搜索"><a href="#复杂的搜索" class="headerlink" title="复杂的搜索"></a>复杂的搜索</h4><figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">GET tj/mail/_search</div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"bool"</span>: &#123;</div><div class="line">      <span class="string">"must"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="string">"match"</span>: &#123;</div><div class="line">            <span class="string">"name"</span>: <span class="string">"dubo"</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      ],</div><div class="line">      <span class="string">"filter"</span>: &#123;</div><div class="line">        <span class="string">"range"</span>: &#123;</div><div class="line">          <span class="string">"age"</span>: &#123;</div><div class="line">            <span class="string">"gte"</span>: <span class="number">10</span>,</div><div class="line">            <span class="string">"lte"</span>: <span class="number">20</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="嵌套过滤器与bool"><a href="#嵌套过滤器与bool" class="headerlink" title="嵌套过滤器与bool"></a>嵌套过滤器与bool</h5><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line"><span class="meta">#搜索大于20岁，并且姓名为dubo或者爱好为book的</span></div><div class="line"><span class="meta">#bool查询中能继续嵌套bool</span></div><div class="line">GET tj<span class="meta-keyword">/mail/</span><span class="class">_search</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"bool"</span>: &#123;</div><div class="line">      <span class="string">"must"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="string">"bool"</span>: &#123;</div><div class="line">            <span class="string">"should"</span>: [</div><div class="line">              &#123;</div><div class="line">                <span class="string">"match"</span>: &#123;</div><div class="line">                  <span class="string">"name"</span>: <span class="string">"dubo"</span></div><div class="line">                &#125;</div><div class="line">              &#125;,</div><div class="line">              &#123;</div><div class="line">                <span class="string">"match"</span>: &#123;</div><div class="line">                  <span class="string">"interests"</span>: <span class="string">"book"</span></div><div class="line">                &#125;</div><div class="line">              &#125;</div><div class="line">            ]</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      ],</div><div class="line">      <span class="string">"filter"</span>: &#123;</div><div class="line">        <span class="string">"range"</span>: &#123;</div><div class="line">          <span class="string">"age"</span>: &#123;</div><div class="line">            </div><div class="line">            <span class="string">"gt"</span>: <span class="number">20</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="搜索相关性得分问题"><a href="#搜索相关性得分问题" class="headerlink" title="搜索相关性得分问题"></a>搜索相关性得分问题</h4><p>Elasticsearch 默认按照相关性得分排序，即每个文档跟查询的匹配程度。<br>Elasticsearch中的 相关性 概念非常重要，也是完全区别于传统关系型数据库的一个概念，数据库中的一条记录要么匹配要么不匹配。</p>
<h4 id="精确匹配"><a href="#精确匹配" class="headerlink" title="精确匹配"></a>精确匹配</h4><p>使用match_phrase精确匹配一系列单词或者短语.<br>切分是根据空格切分<br>如果没有切分，即使match也不会返回</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">GET tj/mail/_search</div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"match_phrase"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: <span class="string">"dubo"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="高亮搜索"><a href="#高亮搜索" class="headerlink" title="高亮搜索"></a>高亮搜索</h4><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line"><span class="meta">#em标签在html为红色斜体</span></div><div class="line">GET tj<span class="meta-keyword">/mail/</span><span class="class">_search</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"match"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: <span class="string">"dubo"</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"highlight"</span>: &#123;</div><div class="line">    <span class="string">"fields"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: &#123;&#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="分析聚合"><a href="#分析聚合" class="headerlink" title="分析聚合"></a>分析聚合</h4><p>Elasticsearch 有一个功能叫聚合（aggregations），允许我们基于数据生成一些精细的分析结果。聚合与 SQL 中的 GROUP BY 类似但更强大。</p>
<p>在使用aggs会提示报错</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line">Fielddata is disabled on text fields by default. </div><div class="line"><span class="builtin-name">Set</span> <span class="attribute">fielddata</span>=<span class="literal">true</span> on [name] <span class="keyword">in</span> order <span class="keyword">to</span> load fielddata <span class="keyword">in</span> memory by uninverting the inverted index. <span class="built_in"></span></div><div class="line">Note that this can however use significant memory. </div><div class="line">Alternatively use a keyword field instead.</div><div class="line">默认情况下，Fielddata在文本字段上禁用。 </div><div class="line">在[name]中设置fielddata = <span class="literal">true</span>，</div><div class="line">以便通过反转反向索引来加载内存中的fielddata。</div></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">PUT my_index/_mapping/my_type</div><div class="line">&#123;</div><div class="line">  <span class="string">"properties"</span>: &#123;</div><div class="line">    <span class="string">"my_field"</span>: &#123; </div><div class="line">      <span class="string">"type"</span>:     <span class="string">"text"</span>,</div><div class="line">      <span class="string">"fielddata"</span>: true</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">GET tj<span class="meta-keyword">/mail/</span><span class="class">_search</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"aggs"</span>: &#123;</div><div class="line">    <span class="string">"NAME"</span>: &#123;</div><div class="line">      <span class="string">"AGG_TYPE"</span>: &#123;&#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">AGG_TYPE可以选择terms,avg,sum,value_count,range</div><div class="line"></div><div class="line"><span class="meta">#计算每种爱好的平均年龄</span></div><div class="line">GET tj<span class="meta-keyword">/mail/</span><span class="class">_search</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"aggs"</span>: &#123;</div><div class="line">    <span class="string">"all_interests"</span>: &#123;</div><div class="line">      <span class="string">"terms"</span>: &#123; <span class="string">"field"</span>: <span class="string">"interests"</span> &#125;,</div><div class="line">      <span class="string">"aggs"</span>: &#123;</div><div class="line">        <span class="string">"ages"</span>: &#123;</div><div class="line">          <span class="string">"avg"</span>: &#123;</div><div class="line">            <span class="string">"field"</span>: <span class="string">"age"</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="权重"><a href="#权重" class="headerlink" title="权重"></a>权重</h4><p>过指定 boost 来控制任何查询语句的相对的权重</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">GET /_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;</div><div class="line">        <span class="string">"bool"</span>: &#123;</div><div class="line">            <span class="string">"must"</span>: &#123;</div><div class="line">                <span class="string">"match"</span>: &#123;  </div><div class="line">                    <span class="string">"content"</span>: &#123;</div><div class="line">                        <span class="string">"query"</span>:    <span class="string">"full text search"</span>,</div><div class="line">                        <span class="string">"operator"</span>: <span class="string">"and"</span></div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="string">"should"</span>: [</div><div class="line">                &#123; <span class="string">"match"</span>: &#123;</div><div class="line">                    <span class="string">"content"</span>: &#123;</div><div class="line">                        <span class="string">"query"</span>: <span class="string">"Elasticsearch"</span>,</div><div class="line">                        <span class="string">"boost"</span>: <span class="number">3</span> </div><div class="line">                    &#125;</div><div class="line">                &#125;&#125;,</div><div class="line">                &#123; <span class="string">"match"</span>: &#123;</div><div class="line">                    <span class="string">"content"</span>: &#123;</div><div class="line">                        <span class="string">"query"</span>: <span class="string">"Lucene"</span>,</div><div class="line">                        <span class="string">"boost"</span>: <span class="number">2</span> </div><div class="line">                    &#125;</div><div class="line">                &#125;&#125;</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="dis-max"><a href="#dis-max" class="headerlink" title="dis_max"></a>dis_max</h4><figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">单个匹配最佳字段</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;</div><div class="line">        <span class="string">"dis_max"</span>: &#123;</div><div class="line">            <span class="string">"queries"</span>: [</div><div class="line">                &#123; <span class="string">"match"</span>: &#123; <span class="string">"title"</span>: <span class="string">"Quick pets"</span> &#125;&#125;,</div><div class="line">                &#123; <span class="string">"match"</span>: &#123; <span class="string">"body"</span>:  <span class="string">"Quick pets"</span> &#125;&#125;</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"hits"</span>: [</div><div class="line">     &#123;</div><div class="line">        <span class="string">"_id"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"_score"</span>: <span class="number">0.12713557</span>, #两个评分一样</div><div class="line">        <span class="string">"_source"</span>: &#123;</div><div class="line">           <span class="string">"title"</span>: <span class="string">"Quick brown rabbits"</span>,</div><div class="line">           <span class="string">"body"</span>: <span class="string">"Brown rabbits are commonly seen."</span></div><div class="line">        &#125;</div><div class="line">     &#125;,</div><div class="line">     &#123;</div><div class="line">        <span class="string">"_id"</span>: <span class="string">"2"</span>,</div><div class="line">        <span class="string">"_score"</span>: <span class="number">0.12713557</span>, </div><div class="line">        <span class="string">"_source"</span>: &#123;</div><div class="line">           <span class="string">"title"</span>: <span class="string">"Keeping pets healthy"</span>,</div><div class="line">           <span class="string">"body"</span>: <span class="string">"My quick brown fox eats rabbits on a regular basis."</span></div><div class="line">        &#125;</div><div class="line">     &#125;</div><div class="line">   ]</div><div class="line">&#125;</div><div class="line"><span class="meta">#我们可能期望同时匹配 title 和 body 字段的文档</span></div><div class="line"><span class="meta">#比只与一个字段匹配的文档的相关度更高，</span></div><div class="line"><span class="meta">#但事实并非如此，</span></div><div class="line"><span class="meta">#因为 dis_max 查询只会简单地使用 单个 最佳匹配语句</span></div><div class="line"><span class="meta">#的评分 _score 作为整体评分。</span></div></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="code"><pre><div class="line">tie_breaker<span class="number">_</span>参数</div><div class="line">可以通过指定 tie_breaker 这个参数将其他匹配语句的评分也考虑其中：</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;</div><div class="line">        <span class="string">"dis_max"</span>: &#123;</div><div class="line">            <span class="string">"queries"</span>: [</div><div class="line">                &#123; <span class="string">"match"</span>: &#123; <span class="string">"title"</span>: <span class="string">"Quick pets"</span> &#125;&#125;,</div><div class="line">                &#123; <span class="string">"match"</span>: &#123; <span class="string">"body"</span>:  <span class="string">"Quick pets"</span> &#125;&#125;</div><div class="line">            ],</div><div class="line">            <span class="string">"tie_breaker"</span>: <span class="number">0</span>.<span class="number">3</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="集群监控操作"><a href="#集群监控操作" class="headerlink" title="集群监控操作"></a>集群监控操作</h1><h4 id="集群健康"><a href="#集群健康" class="headerlink" title="集群健康"></a>集群健康</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line"><span class="builtin-name">GET</span> _cluster<span class="built_in">/health</span></div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="string">"cluster_name"</span>: <span class="string">"PDVM01"</span>, #集群名称</div><div class="line">  <span class="string">"status"</span>: <span class="string">"yellow"</span>,</div><div class="line">  <span class="string">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="string">"number_of_nodes"</span>: 1,</div><div class="line">  <span class="string">"number_of_data_nodes"</span>: 1,</div><div class="line">  <span class="string">"active_primary_shards"</span>: 4, # 指出你集群中的主分片数量。这是涵盖了所有索引的汇总值</div><div class="line">  <span class="string">"active_shards"</span>: 4, #是涵盖了所有索引的_所有_分片的汇总值，即包括副本分片</div><div class="line">  <span class="string">"relocating_shards"</span>: 0, #显示当前正在从一个节点迁往其他节点的分片的数量</div><div class="line">  <span class="string">"initializing_shards"</span>: 0, </div><div class="line">  <span class="string">"unassigned_shards"</span>: 4,</div><div class="line">  <span class="string">"delayed_unassigned_shards"</span>: 0, #推迟的未分配</div><div class="line">  <span class="string">"number_of_pending_tasks"</span>: 0,</div><div class="line">  <span class="string">"number_of_in_flight_fetch"</span>: 0,</div><div class="line">  <span class="string">"task_max_waiting_in_queue_millis"</span>: 0,</div><div class="line">  <span class="string">"active_shards_percent_as_number"</span>: 50</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="builtin-name">GET</span> _cluster/health?<span class="attribute">level</span>=indices</div><div class="line"><span class="comment">#具体至每一个索引</span></div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="string">"cluster_name"</span>: <span class="string">"PDVM01"</span>,</div><div class="line">  <span class="string">"status"</span>: <span class="string">"yellow"</span>,</div><div class="line">  <span class="string">"timed_out"</span>: <span class="literal">false</span>,</div><div class="line">  <span class="string">"number_of_nodes"</span>: 1,</div><div class="line">  <span class="string">"number_of_data_nodes"</span>: 1,</div><div class="line">  <span class="string">"active_primary_shards"</span>: 4,</div><div class="line">  <span class="string">"active_shards"</span>: 4,</div><div class="line">  <span class="string">"relocating_shards"</span>: 0,</div><div class="line">  <span class="string">"initializing_shards"</span>: 0,</div><div class="line">  <span class="string">"unassigned_shards"</span>: 4,</div><div class="line">  <span class="string">"delayed_unassigned_shards"</span>: 0,</div><div class="line">  <span class="string">"number_of_pending_tasks"</span>: 0,</div><div class="line">  <span class="string">"number_of_in_flight_fetch"</span>: 0,</div><div class="line">  <span class="string">"task_max_waiting_in_queue_millis"</span>: 0,</div><div class="line">  <span class="string">"active_shards_percent_as_number"</span>: 50,</div><div class="line">  <span class="string">"indices"</span>: &#123;</div><div class="line">    <span class="string">"tj"</span>: &#123;</div><div class="line">      <span class="string">"status"</span>: <span class="string">"yellow"</span>,</div><div class="line">      <span class="string">"number_of_shards"</span>: 3,</div><div class="line">      <span class="string">"number_of_replicas"</span>: 1,</div><div class="line">      <span class="string">"active_primary_shards"</span>: 3,</div><div class="line">      <span class="string">"active_shards"</span>: 3,</div><div class="line">      <span class="string">"relocating_shards"</span>: 0,</div><div class="line">      <span class="string">"initializing_shards"</span>: 0,</div><div class="line">      <span class="string">"unassigned_shards"</span>: 3</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="集群的部署"><a href="#集群的部署" class="headerlink" title="集群的部署"></a>集群的部署</h1><h4 id="重要配置修改"><a href="#重要配置修改" class="headerlink" title="重要配置修改"></a>重要配置修改</h4><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">指定集群的名字和节点名字</span></div><div class="line">cluster.name:</div><div class="line">node.name:</div><div class="line"><span class="meta">#</span><span class="bash">指定路径</span></div><div class="line"><span class="meta">#</span><span class="bash">默认情况下， Elasticsearch 会把插件、日志以及你最重要的数据放在安装目录下。</span></div><div class="line"><span class="meta">#</span><span class="bash">这会带来不幸的事故， 如果你重新安装 Elasticsearch 的时候不小心把安装目录覆盖了。如果你不小心，你就可能把你的全部数据删掉了。</span></div><div class="line"></div><div class="line">path.data: /path/to/data1,/path/to/data2 </div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> Path to <span class="built_in">log</span> files:</span></div><div class="line">path.logs: /path/to/logs</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> Path to <span class="built_in">where</span> plugins are installed:</span></div><div class="line">path.plugins: /path/to/plugins</div></pre></td></tr></table></figure>
<h1 id="Elasticsearch之元数据"><a href="#Elasticsearch之元数据" class="headerlink" title="Elasticsearch之元数据"></a>Elasticsearch之元数据</h1><h3 id="什么是meta-fields"><a href="#什么是meta-fields" class="headerlink" title="什么是meta-fields"></a>什么是meta-fields</h3><p>在Elasticsearch下，一个文档除了有数据之外，它还包含了元数据(Metadata)。每创建一条数据时，都会对元数据进行写入等操作，当然有些元数据是在创建mapping的时候就会设置,<br>它里面定义了每个添加的doc的处理方式。 类似于数据库的表结构数据。</p>
<h4 id="有哪些meta-fields"><a href="#有哪些meta-fields" class="headerlink" title="有哪些meta-fields"></a>有哪些meta-fields</h4><p>ES中元数据大体分为五中类型：身份元数据、索引元数据、文档元数据、路由元数据以及其他类型的元数据</p>
<ol>
<li><p>身份元数据<br> _index:文档所属索引 , 自动被索引，可被查询，聚合，排序使用，或者脚本里访问</p>
<p> _type：文档所属类型，自动被索引，可被查询，聚合，排序使用，或者脚本里访问</p>
<p> _id：文档的唯一标识</p>
</li>
<li><p>索引元数据<br> _all： 自动组合所有的字段值，以空格分割，可以指定分器词索引，但是整个值不被存储，所以此字段仅仅能被搜索，不能获取到具体的值</p>
<p> _field_names：索引了每个字段的名字，可以包含null值，可以通过exists查询或missing查询方法来校验特定的字段</p>
<p> _timestamp：可以手工指定时间戳值，也可以自动生成使用now()函数，除此之外还可以设置日期的格式化，忽略确实等功能</p>
<p> _ttl：对于一些会话数据或者验证码失效时间，一般来说是有生命周期的，在es中可以很方便的通过这个ttl来设置存活时间，比如1小时，或者10分钟，在超时过后，这个doc会被自动删除，这种方式并不适合按周或按天删除历史数据，如果是这种需求，可考虑使用索引级别的管理方式</p>
</li>
<li><p>文档元数据</p>
<p> _source ： 一个doc的原生的json数据，不会被索引，用于获取提取字段值 ，启动此字段，索引体积会变大，如果既想使用此字段,又想兼顾索引体积，可以开启索引压缩 ._source是可以被禁用的，不过禁用之后部分功能不再支持更新、高亮、重建索引、索引自动修复</p>
</li>
</ol>
<p>数据可以保存到多个不同的目录， 如果将每个目录分别挂载不同的硬盘，这可是一个简单且高效实现一个软磁盘阵列（ RAID 0 ）的办法。Elasticsearch 会自动把条带化（注：RAID 0 又称为 Stripe（条带化），在磁盘阵列中,数据是以条带的方式贯穿在磁盘阵列所有硬盘中的） 数据分隔到不同的目录，以便提高性能。</p>
<h1 id="集群重启"><a href="#集群重启" class="headerlink" title="集群重启"></a>集群重启</h1><p>再关闭一个节点时候，Elasticsearch会立即试图复制这个节点的数据到集群中的其他节点上，这导致大量的IO操作。设置参数避免。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line">PUT /_cluster<span class="built_in">/settings</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"transient"</span>:&#123;cluster.routing.allocation.enable<span class="string">":"</span>none<span class="string">"&#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>等待所有的主分片分配完成后，启动部分分片分配</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><div class="line">PUT /_cluster<span class="built_in">/settings</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"transient"</span>:&#123;<span class="string">"cluster.routing.allocation.enable"</span>:<span class="string">"all"</span>&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="lucene-高亮问题"><a href="#lucene-高亮问题" class="headerlink" title="lucene 高亮问题"></a>lucene 高亮问题</h1><p>高亮的逻辑<br>第一个高亮词前面的片段就是从0到这个词的起始偏移位置，人社部的起止位置为：[26,29],也就是0~26，然后下一次循环的时候srcIndex会变为29,即从29开始再找高亮片段，然后第二个词”杜波”的起止偏移为：[13,16],src.substring(29,13)显然会导致异常，第一个高亮词前面的片段就是从0到这个词的起始偏移位置，阿森纳的起止位置为：[26,29],也就是0~26，然后下一次循环的时候srcIndex会变为29,即从29开始再找高亮片段，然后第二个词”杜波”的起止偏移为：[13,16],src.substring(29,13)显然会导致异常，</p>
<h1 id="bootstrap-memory-lock-true"><a href="#bootstrap-memory-lock-true" class="headerlink" title="bootstrap.memory_lock:true"></a>bootstrap.memory_lock:true</h1><p>关闭swap缓冲区</p>
<p>#elasticsearch性能调优</p>
<ol>
<li>评估集群初始大小信息包括：<ul>
<li>索引吞吐量</li>
<li>文档数</li>
<li>搜索吞吐量</li>
<li>查询类型</li>
<li>热索引文档数</li>
<li>保留策略</li>
<li>需要的响应时间</li>
<li>SLA 级别</li>
</ul>
</li>
<li>显式设置mapping<ul>
<li>Elasticsearch可以动态创建mapping，但这并不适用于所有场景。例如，在Elasticsearch5.x中默认string字段同时是”keyword”和”text”类型。这在很多场景下是不需要的。</li>
</ul>
</li>
<li>如果文档是以用户自定义ID或者路由方式索引的请避免不平衡的分片。<ul>
<li>Elasticsearch使用随机生成DI和hash算法以确保文档均匀的分配到各个分配。当你使用用户自定义ID或者路由，ID或者可能可能不够随机，这样某些索引可能会比其他索引大很多。在这种场景下，在大分片上进行读/写操作可能会比较慢。我们可以使用index.routing_partition_size 优化ID/路由key（5.3及以上版本）</li>
</ul>
</li>
<li></li>
</ol>
<h2 id="Elasticsearch索引文档的过程"><a href="#Elasticsearch索引文档的过程" class="headerlink" title="Elasticsearch索引文档的过程"></a>Elasticsearch索引文档的过程</h2><ul>
<li>协调节点默认使用文档ID参与计算（也支持通过routing），以便为路由提供合适的分片。</li>
</ul>
<figure class="highlight gcode"><table><tr><td class="code"><pre><div class="line">shard = hash<span class="comment">(document_id)</span> <span class="meta">%</span> <span class="comment">(num_of_primary_shards)</span></div></pre></td></tr></table></figure>
<ul>
<li>当分片所在的节点接收到来自协调节点的请求后，会将请求写入到Memory Buffer，然后定时（默认是每隔1秒）写入到Filesystem Cache，这个从Momery Buffer到Filesystem Cache的过程就叫做refresh；</li>
<li>当然在某些情况下，存在Momery Buffer和Filesystem Cache的数据可能会丢失，ES是通过translog的机制来保证数据的可靠性的。其实现机制是接收到请求后，同时也会写入到translog中，当Filesystem cache中的数据写入到磁盘中时，才会清除掉，这个过程叫做flush；</li>
<li>在flush过程中，内存中的缓冲将被清除，内容被写入一个新段，段的fsync将创建一个新的提交点，并将内容刷新到磁盘，旧的translog将被删除并开始一个新的translog。</li>
<li>flush触发的时机是定时触发（默认30分钟）或者translog变得太大（默认为512M）时；</li>
</ul>
<p><img src="http://od4y7wzt7.bkt.clouddn.com/esindex.jpeg" alt="esindex"></p>
<p><strong>以上内容参考萌萌哥ElasticSearch集群部署文档</strong><br><strong>以上内容参考<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/getting-started.html" target="_blank" rel="external">官方API www.elastic.co</a></strong><br><strong>未经授权请勿转载</strong><br><strong>Copyright © 2017 Mr.DuBo. All Rights Reserved</strong></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://dbdb5269.github.io/2017/10/20/ElasticSearch学习笔记/" data-id="cjezpmljr00011ajg5mvmdgqy" class="article-share-link">分享</a><div class="tags"><a href="/tags/学习笔记/">学习笔记</a></div><div class="post-nav"><a href="/2017/10/27/Tika入门学习/" class="pre">Tika入门学习</a><a href="/2017/08/30/Linux基础命令学习/" class="next">Linux基础命令学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://dbdb5269.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Apple/">Apple</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ElasticSearch/">ElasticSearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kafka/">Kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-X/">OS X</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/">Swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tika/">Tika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Xcode/">Xcode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/太原理工大学/">太原理工大学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网站资源/">网站资源</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/模拟登录/" style="font-size: 15px;">模拟登录</a> <a href="/tags/学习笔记/" style="font-size: 15px;">学习笔记</a> <a href="/tags/Linux命令/" style="font-size: 15px;">Linux命令</a> <a href="/tags/菜单栏/" style="font-size: 15px;">菜单栏</a> <a href="/tags/软件/" style="font-size: 15px;">软件</a> <a href="/tags/拓展/" style="font-size: 15px;">拓展</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/三指拖动/" style="font-size: 15px;">三指拖动</a> <a href="/tags/Wi-Fi/" style="font-size: 15px;">Wi-Fi</a> <a href="/tags/PD/" style="font-size: 15px;">PD</a> <a href="/tags/MD5/" style="font-size: 15px;">MD5</a> <a href="/tags/PyCharm/" style="font-size: 15px;">PyCharm</a> <a href="/tags/Email/" style="font-size: 15px;">Email</a> <a href="/tags/QQ/" style="font-size: 15px;">QQ</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/JDK/" style="font-size: 15px;">JDK</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/URP教务系统/" style="font-size: 15px;">URP教务系统</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/IP/" style="font-size: 15px;">IP</a> <a href="/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/slide/" style="font-size: 15px;">slide</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/terminal/" style="font-size: 15px;">terminal</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/Simulator/" style="font-size: 15px;">Simulator</a> <a href="/tags/农银/" style="font-size: 15px;">农银</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/培训/" style="font-size: 15px;">培训</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/大学/" style="font-size: 15px;">大学</a> <a href="/tags/Zookeeper/" style="font-size: 15px;">Zookeeper</a> <a href="/tags/知乎/" style="font-size: 15px;">知乎</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/图片/" style="font-size: 15px;">图片</a> <a href="/tags/链家/" style="font-size: 15px;">链家</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/为什么使用Kafka/">为什么使用Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/搭建Kafka和zookeeper集群/">搭建Kafka和zookeeper集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/nextTheme/">nextTheme</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/30/shell教程指南/">shell教程指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/TCP-IP小故事/">TCP/IP小故事</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/27/Tika入门学习/">Tika入门学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/ElasticSearch学习笔记/">ElasticSearch学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/30/Linux基础命令学习/">Linux基础命令学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/修改MacBook的hostname/">修改MacBook的hostname</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/在农银大学培训的30天/">在农银大学培训的30天</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.mrdubo.com/" title="资源网站" target="_blank">资源网站</a><ul></ul><a href="http://xiaotian.me/" title="天哥" target="_blank">天哥</a><ul></ul><a href="http://zhurunshi.com/" title="润石blog" target="_blank">润石blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">DuBo's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"> 晋ICP备15007212号.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>